<!DOCTYPE html>
<html>
    <head>
        <title>
            Mentor login
        </title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <!-- Bootstrap 5 CSS CDN -->
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
        <style>
            body {
                display: flex;
                justify-content: center;
                align-items: center;
                min-height: 100vh;
                background-color: #f8f9fa; /* Light background */

            .login-container {
                max-width: 400px;
                padding: 30px;
                border-radius: 8px;
                box-shadow: 0 0 15px rgba(0, 0, 0, 0.1);
                background-color: #ffffff;
            }    
            }
        </style>

    </head>
    <body>
        <div class="login-container">
            <h2 class="text-center mb-4">Mentor Login</h2>
            <form id="mentorlogin">
                <div class="mb-3">
                    <label for="email" class="form-label">email:</label>
                    <input type="email" class="form-control" id="email" name="email" placeholder="Enter email" required><br>
                </div>
                <div class="mb-3">     
                    <label for="password" class="form-label">password:</label>
                    <input type="password" class="form-control" id="password" name="password" placeholder="Enter valid password" required><br>
                <button type="submit" class="btn btn-primary">Login</button>        
                </form>


            <div id="message" class="mt-3 text-center" style="margin-top: 10px;"></div>

            <p class="text-center mt-3">
                <a href="mentor.html">To create new account, sign up here </a>    

            </p>
        </div>    

        
        <script>
            document.addEventListener("DOMContentLoaded", function() {
                const form = document.getElementById("mentorlogin");
                const messageDiv = document.getElementById("message");

                form.addEventListener("submit", function(e) {
                    e.preventDefault();

                    const email = document.getElementById("email").value;
                    const password = document.getElementById("password").value;

                    messageDiv.textContent = '';
                    messageDiv.style.color = 'black';

                    fetch("/api/mentor-login", {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json",
                        },
                        body: JSON.stringify({email, password}),
                    })

                        .then(response => {
                            if (!response.ok) {
                                return response.json().then(err => {
                                     throw new Error(err.message || 'Login failed');})
                            }
                            return response.json();
                        })

                        .then(data => {
                            if(data.success){
                                messageDiv.textContent = data.message;
                                messageDiv.style.color = 'green';
                                // Redirect to mentor's personalized profile page using the slug
                                if (data.redirectUrl) {
                                    window.location.href = '/mentor-dashboard';
                                } else {
                                    window.location.href = '/mentor-area';
                                }    
                            }else {
                                messageDiv.textContent = data.message || "Login failed. Please Check the credentials"
                            }
                        })

                        .catch(error => {
                            console.error("Error during Login fetch", error);
                            messageDiv.textContent = "An error occured:" + error.message;
                            messageDiv.style.color = 'red';
                        });
                });
            });

        </script> 
    </body>
</html>